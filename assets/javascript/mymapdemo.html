<!DOCTYPE html>
<html>
  <head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-2.2.3.js" integrity="sha256-laXWtGydpwqJ8JA+X9x2miwmaiKhn8tVmOVEigRNtP4=" crossorigin="anonymous"></script>
    <style>
       #map {
        height: 400px;
        width: 100%;
       }
    </style>
  </head>
  <body>
  	<h3>My Google Maps Demo</h3>
    <div id="map"></div>
	<form role="form">
		<div class="form-group">
			<label for="text">Food Truck</label>
			<input type="text" class="form-control" id="inputName">
		</div>
		<button type="submit" class="btn" id="inputSubmit">mark your location on the map</button>
	</form>

	<script src="https://www.gstatic.com/firebasejs/3.6.0/firebase.js"></script>
	<script>
	  // Initialize Firebase
		var config = {
		    apiKey: "AIzaSyAOkQTvd4rh7eM1YQWGMdTvOF2iwBELflU",
		    authDomain: "testproject1-882fe.firebaseapp.com",
		    databaseURL: "https://testproject1-882fe.firebaseio.com",
		    storageBucket: "testproject1-882fe.appspot.com",
		    messagingSenderId: "527597865615"
		};
	  
	  	firebase.initializeApp(config);
	  	var database = firebase.database();
	  	var map; //to be initialized by initMap. this is a global.


	    var la = {
	    	name: "los angeles",
	    	pos: {lat: 34.060815, lng: -118.447205} //gayley building
	    };

	    function initMap() {
        	 map = new google.maps.Map(document.getElementById('map'), {
        		zoom: 11,
          		center: la.pos //gayley building
	        });
        }

        $("#inputSubmit").on("click", function(){
        	console.log("click");
        	if (navigator.geolocation) {
          		navigator.geolocation.getCurrentPosition(function(position) {

          			var newPos = {
          				name: $("#inputName").val().trim(),
          				pos: {
          					lat: position.coords.latitude,
              				lng: position.coords.longitude,
              				dateAdded: firebase.database.ServerValue.TIMESTAMP
          				}
          			};
          			console.log(newPos);
          			database.ref().push(newPos);
          		}, function() {
            		handleLocationError(true, infoWindow, map.getCenter());
          		});
        	} else {
          		// Browser doesn't support Geolocation
          		handleLocationError(false, infoWindow, map.getCenter());
        	}


        	
        	return false;
        });

        database.ref().on("child_added", function(childSnapshot){

        	var marker = new google.maps.Marker({
          		position: childSnapshot.val().pos,
          		map: map
          	});
        });




    </script>
	<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLaTDL2FZ7OHuViBsdUqtKSJZfaDVMavk&callback=initMap">
    </script>

  </body>
</html>
