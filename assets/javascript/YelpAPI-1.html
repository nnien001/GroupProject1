<html>
        <head>
            <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
            <meta content="utf-8" http-equiv="encoding">
            <title>Yelp OAuth Example</title>
            <style type="text/css">
                h1 {    text-align: center; font-size: 40px; color: white;}
                 button, div, form, input {
                margin: 10px;
                }
        
                body { background-image: url("assets/images/background-image.jpg"); color : black;}

                #giphy-form { font-size: 25px; }
                #outerDiv { font-size: 20px; }
                #addgifs{font-size: 20px;}
                #map {height: 400px; width: 100%; }



            </style>
        </head>
        <body>

            <form id="find-form">
              <label for="truck-input"> <strong>Find your food-truck</strong></label>
              <input type="text" id="truck-input"><br>
              <input class= "getResults" type="submit" value="Submit">
            </form>

            <div id="map"></div>

            <div id="displayResults"></div>


            <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
            <script type="text/javascript" src="yelp1.js"></script>
            <script type="text/javascript" src="yelp2.js"></script>
            <script type="text/javascript">

                var resultArray = new Array;

                var near; 


                function cb(data) {        
                    console.log("cb: " + JSON.stringify(data));
                    //console.log( "data : " + JSON.stringify(data));
                     console.log( "data : " + JSON.stringify(data.businesses[0].rating));
                     console.log( "data : " + JSON.stringify(data.businesses[0].location));
                     console.log( "latitude : " + JSON.stringify(data.businesses[0].location.coordinate.latitude));
                     console.log( "longitude : " + JSON.stringify(data.businesses[0].location.coordinate.longitude));


                     console.log( "data : " + JSON.stringify(data.businesses[0].id));
                     console.log( "data : " + JSON.stringify(data.businesses[0].price));
                     console.log( "data : " + JSON.stringify(data.businesses[0].image_url));
                     console.log( "data : " + JSON.stringify(data.businesses[0].rating_img_url));


                    for (var i = 0; i<10; i++) {

                        resultObject = 
                        {   
                            id: data.businesses[i].id, 
                            resultImage: data.businesses[i].image_url,
                            rating : data.businesses[i].rating,
                            ratingImg : data.businesses[i].rating_img_url,
                            location : data.businesses[i].location.display_address,
                            latitude : data.businesses[i].location.coordinate.latitude,
                            longitude: data.businesses[i].location.coordinate.longitude
                        };

                        var image1 = $('<img>').attr('src', resultObject.resultImage);

                        var image2 = $('<img>').attr('src',resultObject.ratingImg);

                        resultArray.push(resultObject);

                        titleDiv = $('<div>').text((i + 1) +  ": ");

                        titleDiv.append(resultObject.id);
                        imgDiv = $('<div>').append(image1);
                        ratingDiv = $('<div>').append("Rating: " + resultObject.rating);
                        ratingImgDiv = $('<div>').append(image2);
                        locationDiv = $('<div>').append("Location: " + resultObject.location);

                        $('#displayResults').append(titleDiv,imgDiv,ratingDiv, ratingImgDiv, locationDiv);

                        buildMarker(resultObject.latitude, resultObject.longitude, (i+1).toString());
                    }
                }


                 // $('.getResults').on('click', function()

                 //    {

                 //        debugger;
                
                    var auth = {
                        consumerKey : "tdDeaUZsKmwWPlAHcAXrBQ",
                        consumerSecret : "Mc5OMuJ5LUzJ4H8i7olOPE0eBxo",
                        accessToken : "vxc5hq9rwljvRnhke3uz08t3LPTvTKIt",
                        // This example is a proof of concept, for how to use the Yelp v2 API with javascript.
                        // You wouldn't actually want to expose your access token secret like this in a real application.
                        accessTokenSecret : "NGYjH8ZYKU-lSjHuD_vFTfqMsvg",
                        serviceProvider : {
                            signatureMethod : "HMAC-SHA1"
                                          }
                    };
            
                        
                   // near = $('#truck-input').val().trim();

                   // console.log(near);

                    var terms = 'Food Trucks';
                    var near = 'Los'+'Angeles';

                    var accessor = {
                        consumerSecret : auth.consumerSecret,
                        tokenSecret : auth.accessTokenSecret
                    };

                    var parameters = [];
                    parameters.push(['term', terms]);
                    parameters.push(['location', near]);
                    parameters.push(['callback', 'cb']);
                    parameters.push(['oauth_consumer_key', auth.consumerKey]);
                    parameters.push(['oauth_consumer_secret', auth.consumerSecret]);
                    parameters.push(['oauth_token', auth.accessToken]);
                    parameters.push(['oauth_signature_method', 'HMAC-SHA1']);
            
                    var message = {
                        'action' : 'https://api.yelp.com/v2/search',
                        'method' : 'GET',
                        'parameters' : parameters
                    };
            
                    OAuth.setTimestampAndNonce(message);
                    OAuth.SignatureMethod.sign(message, accessor);
            
                    var parameterMap = OAuth.getParameterMap(message.parameters);
                        
                    $.ajax({
                        'url' : message.action,
                        'data' : parameterMap,
                        'dataType' : 'jsonp',
                        'jsonpCallback' : 'cb',
                        'cache': true
                    })
                    .done(function(data, textStatus, jqXHR) {
                          //  console.log('success[' + data + '], status[' + textStatus + '], jqXHR[' + JSON.stringify(jqXHR) + ']');
                        }
                    )
                    .fail(function(jqXHR, textStatus, errorThrown) {
                                        console.log('error[' + errorThrown + '], status[' + textStatus + '], jqXHR[' + JSON.stringify(jqXHR) + ']');
                            }
                    );

                    function initMap() {
                        map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 11,
                            center: {lat: 34.060815, lng: -118.447205} //gayley building
                        });
                    }

                    function buildMarker(latitude, longitude, counter) {
                        console.log("buildmarker: ", latitude, longitude);
                        var pos = {
                            lat: latitude,
                            lng: longitude
                        }

                        var marker = new google.maps.Marker({
                            position: pos,
                            map: map,
                            label: { text: counter }

                        });

                    }
        
            </script>
            <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLaTDL2FZ7OHuViBsdUqtKSJZfaDVMavk&callback=initMap">
            </script>

        </body>
</html>